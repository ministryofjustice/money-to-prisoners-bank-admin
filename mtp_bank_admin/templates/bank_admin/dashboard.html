{% extends 'base.html' %}
{% load i18n %}
{% load dates %}
{% load mtp_common %}

{% block page_title %}{% trans 'Download files' %} – {{ block.super }}{% endblock %}

{% block inner_content %}
  <div class="mtp-compact">
    {% get_preceding_workdays 5 offset=1 as preceding_days %}

    <header>
      <h1 class="heading-xlarge">{% trans 'Download files' %}</h1>
    </header>

    {% include 'mtp_common/includes/message_box.html' %}

    <div class="container">

      <div class="mtp-compact__row-1">
        {% if perms.transaction.view_bank_details_transaction %}
        <section>
          <h2 class="heading-small">{% trans 'Access Pay file – refunds' %}</h2>
          {% url 'bank_admin:download_refund_file' as base_download_url %}
          {% for day in preceding_days %}
            {% blocktrans with date=day|date:'d/m/Y' asvar download_label %}Download file for {{ date }}{% endblocktrans %}

            {% if forloop.first %}
          <div class="mtp-filelink">
              <a href="{{ base_download_url }}?receipt_date={{ day|date:'Y-m-d' }}">
              {{ download_label }}
              </a>
          </div>

          <p>
            <a class="mtp-disclosure" href="#" aria-controls="previous-ap-refunds" aria-expanded="false" role="button" data-analytics="pageview,/-help_open/previous-ap-refunds/">
              <span></span>{% trans 'Previous AccessPay refund files' %}
            </a>
          </p>
          <div id="previous-ap-refunds" class="mtp-disclosure__contents panel panel-border-narrow">
            <ul class="list list-bullet">
            {% else %}
              <li>
                <a href="{{ base_download_url }}?receipt_date={{ day|date:'Y-m-d' }}">
                    {{ download_label }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
            </ul>
          </div>
        </section>
        {% endif %}

        {% if perms.credit.view_any_credit %}
        <section>
          <h2 class="heading-small">{% trans 'ADI Journal' %}</h2>
          {% url 'bank_admin:download_adi_journal' as base_download_url %}
          {% for day in preceding_days %}
            {% blocktrans with date=day|date:'d/m/Y' asvar download_label %}Download transactions for {{ date }}{% endblocktrans %}

            {% if forloop.first %}
          <div class="mtp-filelink">
            <a href="{{ base_download_url }}?receipt_date={{ day|date:'Y-m-d' }}">
            {{ download_label }}
            </a>
          </div>

          <p>
            <a class="mtp-disclosure" href="#" aria-controls="previous-adi-journals" aria-expanded="false" role="button" data-analytics="pageview,/-help_open/previous-adi-journals/">
              <span></span>{% trans 'Previous ADI Journals' %}
            </a>
          </p>
          <div id="previous-adi-journals" class="mtp-disclosure__contents panel panel-border-narrow">
            <ul class="list list-bullet">
            {% else %}
              <li>
                <a href="{{ base_download_url }}?receipt_date={{ day|date:'Y-m-d' }}">
                  {{ download_label }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
            </ul>
          </div>
        </section>
        {% endif %}
      </div>

      <div class="mtp-compact__row-2">
        {% if perms.transaction.view_transaction %}
        <section>
          <h2 class="heading-small">{% trans 'Bank statement' %}</h2>
          {% url 'bank_admin:download_bank_statement' as base_download_url %}
          {% for day in preceding_days %}
            {% blocktrans with date=day|date:'d/m/Y' asvar download_label %}Download transactions for {{ date }}{% endblocktrans %}

            {% if forloop.first %}
          <div class="mtp-filelink">
            <a href="{{ base_download_url }}?receipt_date={{ day|date:'Y-m-d' }}">
            {{ download_label }}
            </a>
          </div>

          <p>
            <a class="mtp-disclosure" href="#" aria-controls="previous-statements" aria-expanded="false" role="button" data-analytics="pageview,/-help_open/previous-statements/">
              <span></span>{% trans 'Previous bank statements' %}
            </a>
          </p>
          <div id="previous-statements" class="mtp-disclosure__contents panel panel-border-narrow">
            <ul class="list list-bullet">
              {% else %}
              <li>
                <a href="{{ base_download_url }}?receipt_date={{ day|date:'Y-m-d' }}">
                  {{ download_label }}
                </a>
              </li>
              {% endif %}
          {% endfor %}
            </ul>
          </div>
        </section>
        {% endif %}

        {% if perms.disbursement.view_disbursement %}
        <section>
          <h2 class="heading-small">{% trans 'Disbursements' %}</h2>
          {% url 'bank_admin:download_disbursements' as base_download_url %}
          {% for day in preceding_days %}
            {% blocktrans with date=day|date:'d/m/Y' asvar download_label %}Download disbursements for {{ date }}{% endblocktrans %}

            {% if forloop.first %}
          <div class="mtp-filelink">
            <a href="{{ base_download_url }}?receipt_date={{ day|date:'Y-m-d' }}">
            {{ download_label }}
            </a>
          </div>

          <p>
            <a class="mtp-disclosure" href="#" aria-controls="previous-disbursements" aria-expanded="false" role="button" data-analytics="pageview,/-help_open/previous-adi-journals/">
              <span></span>{% trans 'Previous Disbursements' %}
            </a>
          </p>
          <div id="previous-disbursements" class="mtp-disclosure__contents panel panel-border-narrow">
            <ul class="list list-bullet">
            {% else %}
              <li>
                <a href="{{ base_download_url }}?receipt_date={{ day|date:'Y-m-d' }}">
                  {{ download_label }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
            </ul>
          </div>
        </section>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}
